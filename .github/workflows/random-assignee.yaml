name: Get Random Assignee

on:
  push:
    branches:
    - 'feature/*'

jobs:
  assign:

    runs-on: ubuntu-latest

    steps:
    - name: Get event payload
      shell: pwsh
      run: |
        $payload = "${{ toJSON(github) }}"
        $payload = $payload -replace '\r\n', '\n'
        $payload = $payload -replace '\r', '\n'
        $payload = $payload -replace '\n', '\r\n'
        echo "$payload"

    - name: Get random assignee
      id: assignee
      shell: pwsh
      run: |
        $scriptUrl = "https://raw.githubusercontent.com/hackersground-kr/operations/feature/random-assignee/get-randomassignee/Get-RandomAssignee.ps1"
        Invoke-RestMethod $scriptUrl | Out-File ~/Get-RandomAssignee.ps1
        $assignee = $(~/Get-RandomAssignee.ps1 -Assignees "${{ secrets.ASSIGNEES }}")

        echo "value=$assignee" | Out-File -FilePath $env:GITHUB_OUTPUT -Encoding utf-8 -Append

    - name: Show assignee
      shell: pwsh
      run: |
        echo "${{ steps.assignee.outputs.value }}"
